namespace = perma_planetery_decisions

# Add perma luxury or Update luxury cost
planet_event = {
	id = perma_planetery_decisions.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_planet_flag = has_perma_luxuries_boost
		remove_modifier = planet_luxuries_boost
		add_modifier = {
			modifier = "planet_luxuries_boost"
		}

		while = {
			limit = {
				has_deposit = perma_luxuries_boost_deposit
			}
			remove_deposit = perma_luxuries_boost_deposit
		}

		set_variable = {
			which = deposit_count
			value = 0
		}
		export_trigger_value_to_variable = {
			trigger = num_pops
			variable = deposit_count
		}
		divide_variable = {
			which = deposit_count
			value = 10
		}
		if = {
			limit = {
				check_variable = {
					which = deposit_count
					value > 10
				}
			}
			set_variable = {
				which = deposit_count
				value = 10
			}
		}
		set_variable = {
			which = i
			value = 1
		}
		while = {
			limit = {
				check_variable = {
					which = i
					value < deposit_count
				}
			}
			THIS = {
				add_deposit = perma_luxuries_boost_deposit
			}
			change_variable = {
				which = i
				value = 1
			}
		}
	}
}

# Update cost on every owned planet
country_event = {
	id = perma_planetery_decisions.2
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		every_owned_planet = {
			if = {
				limit = { has_planet_flag = has_perma_luxuries_boost}
				planet_event = {
					id = perma_planetery_decisions.1  # update cost
				}
			}
		}
	}
}

# Perma food
planet_event = {
	id = perma_planetery_decisions.3
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		add_deposit = perma_food_boost_deposit
		remove_modifier = planet_food_boost
		add_modifier = {
			modifier = "planet_food_boost"
		}
		set_planet_flag = has_perma_food_boost
	}
}

# Remove perma food
planet_event = {
	id = perma_planetery_decisions.13
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		remove_modifier = planet_food_boost
		remove_deposit = perma_food_boost_deposit
		remove_planet_flag = has_perma_food_boost
	}
}

# Remove perma luxury
planet_event = {
	id = perma_planetery_decisions.11
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		remove_modifier = planet_luxuries_boost
		remove_planet_flag = has_perma_luxuries_boost
		while = {
			limit = {
				has_deposit = perma_luxuries_boost_deposit
			}
			remove_deposit = perma_luxuries_boost_deposit
		}
	}
}